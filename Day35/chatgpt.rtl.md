### ADC و DAC در سیستم‌های توکار

ADC (Analog-to-Digital Converter) و DAC (Digital-to-Analog Converter)
 دو مولفه مهم در سیستم‌های توکار هستند که تبدیل بین سیگنال‌های آنالوگ و دیجیتال را ممکن می‌سازند.

### 1. مبدل آنالوگ به دیجیتال (ADC)

ADC وظیفه تبدیل سیگنال‌های آنالوگ به داده‌های دیجیتال را دارد. این مبدل‌ها در بسیاری از کاربردهای توکار از جمله سنسورها، پردازش سیگنال‌ها، و کنترل‌های صنعتی استفاده می‌شوند.

#### اصول کارکرد ADC

ADC یک سیگنال ولتاژ آنالوگ را دریافت و آن را به یک عدد دیجیتال که نمایانگر ولتاژ ورودی است تبدیل می‌کند. این تبدیل به چند مرحله تقسیم می‌شود:

1. **نمونه‌برداری (Sampling):** ولتاژ آنالوگ ورودی در فواصل زمانی معین نمونه‌برداری می‌شود.
2. **نگهداری (Hold):** ولتاژ نمونه‌برداری شده ثابت نگه داشته می‌شود تا بتوان آن را پردازش کرد.
3. **کوانتیزه‌سازی (Quantization):** ولتاژ نمونه‌برداری شده به نزدیک‌ترین مقدار دیجیتال تبدیل می‌شود.
4. **رمزگذاری (Encoding):** مقدار کوانتیزه شده به یک عدد باینری تبدیل می‌شود.

#### استفاده از ADC با HAL

در اینجا یک مثال از استفاده از ADC برای خواندن یک مقدار آنالوگ از سنسور و نمایش آن بر روی یک پورت سریال آورده شده است:

```cpp
#include "main.h"

ADC_HandleTypeDef hadc1;

void SystemClock_Config(void);
static void MX_GPIO_Init(void);
static void MX_ADC1_Init(void);

int main(void) {
    HAL_Init();
    SystemClock_Config();
    MX_GPIO_Init();
    MX_ADC1_Init();

    while (1) {
        HAL_ADC_Start(&hadc1);
        if (HAL_ADC_PollForConversion(&hadc1, 1000) == HAL_OK) {
            uint32_t adcValue = HAL_ADC_GetValue(&hadc1);
            printf("ADC Value: %ld\r\n", adcValue);
        }
        HAL_ADC_Stop(&hadc1);
        HAL_Delay(1000);
    }
}

void SystemClock_Config(void) {
    // System clock configuration code
}

static void MX_GPIO_Init(void) {
    // GPIO initialization code
}

static void MX_ADC1_Init(void) {
    hadc1.Instance = ADC1;
    hadc1.Init.ClockPrescaler = ADC_CLOCK_SYNC_PCLK_DIV4;
    hadc1.Init.Resolution = ADC_RESOLUTION_12B;
    hadc1.Init.ScanConvMode = DISABLE;
    hadc1.Init.ContinuousConvMode = DISABLE;
    hadc1.Init.DiscontinuousConvMode = DISABLE;
    hadc1.Init.ExternalTrigConv = ADC_SOFTWARE_START;
    hadc1.Init.DataAlign = ADC_DATAALIGN_RIGHT;
    hadc1.Init.NbrOfConversion = 1;
    if (HAL_ADC_Init(&hadc1) != HAL_OK) {
        Error_Handler();
    }
}

void Error_Handler(void) {
    while (1) {
        // Stay here
    }
}
```

### 2. مبدل دیجیتال به آنالوگ (DAC)

DAC وظیفه تبدیل سیگنال‌های دیجیتال به ولتاژهای آنالوگ را دارد. این مبدل‌ها برای تولید سیگنال‌های آنالوگ مانند موج‌های سینوسی، صدای آنالوگ، و کنترل ولتاژ در سیستم‌های مختلف استفاده می‌شوند.

#### اصول کارکرد DAC

DAC یک عدد دیجیتال ورودی را دریافت و آن را به یک ولتاژ آنالوگ تبدیل می‌کند. این تبدیل نیز به چند مرحله تقسیم می‌شود:

1. **دریافت ورودی دیجیتال:** عدد دیجیتال ورودی دریافت می‌شود.
2. **تبدیل دیجیتال به ولتاژ:** عدد دیجیتال به یک ولتاژ متناظر تبدیل می‌شود.
3. **تولید سیگنال آنالوگ:** ولتاژ تولید شده به عنوان سیگنال آنالوگ خروجی داده می‌شود.

#### استفاده از DAC با HAL

در اینجا یک مثال از استفاده از DAC برای تولید یک ولتاژ آنالوگ و خروج آن بر روی یک پین آورده شده است:

```cpp
#include "main.h"

DAC_HandleTypeDef hdac;

void SystemClock_Config(void);
static void MX_GPIO_Init(void);
static void MX_DAC_Init(void);

int main(void) {
    HAL_Init();
    SystemClock_Config();
    MX_GPIO_Init();
    MX_DAC_Init();

    while (1) {
        HAL_DAC_SetValue(&hdac, DAC_CHANNEL_1, DAC_ALIGN_12B_R, 2048);
        HAL_DAC_Start(&hdac, DAC_CHANNEL_1);
        HAL_Delay(1000);
    }
}

void SystemClock_Config(void) {
    // System clock configuration code
}

static void MX_GPIO_Init(void) {
    // GPIO initialization code
}

static void MX_DAC_Init(void) {
    hdac.Instance = DAC;
    if (HAL_DAC_Init(&hdac) != HAL_OK) {
        Error_Handler();
    }

    DAC_ChannelConfTypeDef sConfig = {0};
    sConfig.DAC_Trigger = DAC_TRIGGER_NONE;
    sConfig.DAC_OutputBuffer = DAC_OUTPUTBUFFER_ENABLE;
    if (HAL_DAC_ConfigChannel(&hdac, &sConfig, DAC_CHANNEL_1) != HAL_OK) {
        Error_Handler();
    }
}

void Error_Handler(void) {
    while (1) {
        // Stay here
    }
}
```

### توضیحات:

- `HAL_ADC_Init()`: ADC را پیکربندی می‌کند.
- `HAL_ADC_Start()`: تبدیل آنالوگ به دیجیتال را شروع می‌کند.
- `HAL_ADC_PollForConversion()`: منتظر اتمام تبدیل می‌ماند.
- `HAL_ADC_GetValue()`: مقدار دیجیتال حاصل از تبدیل را دریافت می‌کند.
- `HAL_DAC_Init()`: DAC را پیکربندی می‌کند.
- `HAL_DAC_SetValue()`: مقدار دیجیتال را برای تبدیل به ولتاژ آنالوگ تنظیم می‌کند.
- `HAL_DAC_Start()`: تبدیل دیجیتال به آنالوگ را شروع می‌کند.

### نتیجه‌گیری

ADC و DAC دو مولفه مهم در سیستم‌های توکار هستند که امکان ارتباط با سنسورها و عملگرهای آنالوگ را فراهم می‌کنند. با استفاده از کتابخانه HAL، می‌توان به راحتی این مبدل‌ها را پیکربندی و استفاده کرد تا سیگنال‌های آنالوگ را به دیجیتال و بالعکس تبدیل نمود.
### نیاز به تبدیل داده‌ها با استفاده از ADC و DAC

#### دلایل و موارد استفاده از ADC و DAC

ADC (مبدل آنالوگ به دیجیتال) و DAC (مبدل دیجیتال به آنالوگ) در سیستم‌های تعبیه‌شده کاربردهای زیادی دارند و در بسیاری از پروژه‌های الکترونیکی و توکار ضروری هستند. در زیر دلایل و زمان‌هایی که نیاز به استفاده از این مبدل‌ها داریم توضیح داده شده است:

### 1. دلایل استفاده از ADC

#### 1.1. اندازه‌گیری سیگنال‌های آنالوگ

- **سنسورها و ترنسدیوسرها:** بسیاری از سنسورها مانند سنسورهای دما، فشار، رطوبت و نور سیگنال‌های خروجی آنالوگ تولید می‌کنند. برای پردازش این سیگنال‌ها توسط میکروکنترلر یا کامپیوتر، باید این سیگنال‌ها را به داده‌های دیجیتال تبدیل کنیم.
- **مانیتورینگ ولتاژ و جریان:** در سیستم‌های قدرت، نظارت بر ولتاژ و جریان از اهمیت بالایی برخوردار است. این سیگنال‌های آنالوگ باید به داده‌های دیجیتال تبدیل شوند تا توسط میکروکنترلر پردازش و تحلیل شوند.

#### 1.2. پردازش سیگنال‌های آنالوگ

- **پردازش سیگنال:** برای پردازش سیگنال‌های صوتی، تصویری و سایر سیگنال‌های آنالوگ، نیاز به تبدیل آنها به داده‌های دیجیتال داریم. پس از پردازش، می‌توانیم این داده‌ها را ذخیره، انتقال یا نمایش دهیم.
- **کنترل فیدبک:** در سیستم‌های کنترل فیدبک، مانند سیستم‌های کنترل دما، سرعت موتور و غیره، نیاز به اندازه‌گیری سیگنال‌های آنالوگ و تبدیل آنها به داده‌های دیجیتال داریم.

### 2. دلایل استفاده از DAC

#### 2.1. تولید سیگنال‌های آنالوگ

- **تولید سیگنال‌های صوتی:** برای تولید صدا در سیستم‌های صوتی، نیاز به تبدیل داده‌های دیجیتال به سیگنال‌های آنالوگ داریم که بتوان آنها را توسط اسپیکرها پخش کرد.
- **تولید سیگنال‌های تصویری:** در سیستم‌های نمایش تصویر، داده‌های دیجیتال باید به سیگنال‌های آنالوگ تبدیل شوند تا بتوان آنها را بر روی نمایشگرهای آنالوگ نمایش داد.

#### 2.2. کنترل دستگاه‌های آنالوگ

- **کنترل ولتاژ و جریان:** در برخی سیستم‌ها نیاز به تولید ولتاژ یا جریان آنالوگ مشخصی داریم که برای کنترل دستگاه‌های آنالوگ مورد استفاده قرار می‌گیرد.
- **تولید شکل موج‌های خاص:** در برخی کاربردها مانند تست و اندازه‌گیری، نیاز به تولید شکل موج‌های آنالوگ خاصی داریم که توسط DAC ایجاد می‌شوند.

### زمان و موارد استفاده

#### 1. سیستم‌های سنسور

زمانی که با سنسورهایی کار می‌کنیم که خروجی آنالوگ دارند، مانند سنسورهای دما، فشار، رطوبت و غیره، نیاز به استفاده از ADC داریم تا این سیگنال‌ها را به داده‌های دیجیتال تبدیل کنیم و توسط میکروکنترلر پردازش کنیم.

#### 2. سیستم‌های صوتی و تصویری

در سیستم‌های صوتی، برای تبدیل داده‌های دیجیتال صوتی به سیگنال‌های آنالوگ که بتوان آنها را توسط اسپیکرها پخش کرد، نیاز به DAC داریم. در سیستم‌های تصویری نیز برای نمایش داده‌های دیجیتال بر روی نمایشگرهای آنالوگ نیاز به DAC داریم.

#### 3. سیستم‌های کنترل و اتوماسیون

در سیستم‌های کنترل صنعتی و اتوماسیون، نیاز به اندازه‌گیری سیگنال‌های آنالوگ و پردازش آنها توسط میکروکنترلر داریم که از ADC استفاده می‌کنیم. همچنین برای کنترل دستگاه‌های آنالوگ و تولید سیگنال‌های کنترلی نیاز به DAC داریم.

#### 4. سیستم‌های قدرت

در سیستم‌های قدرت برای نظارت بر ولتاژ و جریان و پردازش این سیگنال‌ها توسط میکروکنترلر نیاز به ADC داریم. همچنین برای کنترل و تنظیم ولتاژ و جریان خروجی نیاز به DAC داریم.

### نتیجه‌گیری

استفاده از ADC و DAC در سیستم‌های توکار ضروری است زیرا این مبدل‌ها امکان ارتباط با دنیای آنالوگ و پردازش سیگنال‌های آنالوگ را فراهم می‌کنند. با استفاده از این مبدل‌ها، می‌توانیم سیگنال‌های آنالوگ را اندازه‌گیری، پردازش و کنترل کنیم و دستگاه‌های دیجیتال و آنالوگ را به هم متصل کنیم.